<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150928" />
    <meta http-equiv="Content-Language" content="en" />
    <title>EHRI Backend &#x2013; Initialising a fresh Neo4j database and importing some EAD</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                        <img src="https://ehri-project.eu/sites/all/themes/ehri_new/images/logo.png"  alt="EHRI Backend"/>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-09-28
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.11.0-SNAPSHOT
                          <span class="divider">|</span>
                      </li>
                                      <li class="">
                    <a href="index.html" title="EHRI Backend">
        EHRI Backend</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Initialising a fresh Neo4j database and importing some EAD</li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Developer Notes</li>
                              
      <li>
  
                          <a href="install.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                
      <li>
  
                          <a href="deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Importing Data</a>
          </li>
                
      <li>
  
                          <a href="gotchas.html" title="Gotchas">
          <i class="none"></i>
        Gotchas</a>
            </li>
                
      <li>
  
                          <a href="migrations.html" title="DB Migration History">
          <i class="none"></i>
        DB Migration History</a>
            </li>
                
      <li>
  
                          <a href="scripting.html" title="Scripting">
          <i class="none"></i>
        Scripting</a>
            </li>
                
      <li>
  
                          <a href="permissions.html" title="Permissions">
          <i class="none"></i>
        Permissions</a>
            </li>
                
      <li>
  
                          <a href="serialization.html" title="Data Serialization Config">
          <i class="none"></i>
        Data Serialization Config</a>
            </li>
                
      <li>
  
                          <a href="validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="identifiers.html" title="Identifiers">
          <i class="none"></i>
        Identifiers</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="ehri-definitions/index.html" title="Data Definitions">
          <i class="none"></i>
        Data Definitions</a>
            </li>
                
      <li>
  
                          <a href="ehri-frames/index.html" title="Core Java API">
          <i class="none"></i>
        Core Java API</a>
            </li>
                
      <li>
  
                          <a href="ehri-extension/index.html" title="Web Service">
          <i class="none"></i>
        Web Service</a>
            </li>
                
      <li>
  
                          <a href="ehri-importers/index.html" title="Import Tools">
          <i class="none"></i>
        Import Tools</a>
            </li>
                
      <li>
  
                          <a href="ehri-cmdline/index.html" title="Command Line Utilities">
          <i class="none"></i>
        Command Line Utilities</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                            
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
                              <li class="nav-header">API Docs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Javadocs">
          <i class="none"></i>
        Javadocs</a>
            </li>
                              <li class="nav-header">Web Service Docs</li>
                              
      <li>
  
                          <a href="ehri-extension/wsdocs/index.html" title="Web API">
          <i class="none"></i>
        Web API</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Initialising a fresh Neo4j database and importing some EAD</h1>
<p>First, make sure there is no Neo4j server running that uses the graph DB you&#x2019;re about to build.</p>
<div class="section">
<h2><a name="Set_Vital_Environment_vars"></a>Set Vital Environment var(s)</h2>
<p>The <b>NEO4J_HOME</b> env var must be set and point to the Neo4j instance with the EHRI libs <a href="INSTALL.md">installed</a>.</p>
<p>A second var that <i>may</i> be set is <b>NEO4J_DB</b>, which should point to the actual database directory. If not set, this will default to <tt>$NEO4J_HOME/data/graph.db</tt>.</p></div>
<div class="section">
<h2><a name="Make_sure_the_Neo4j_Server_is_stopped"></a>Make sure the Neo4j Server is stopped</h2>
<p>At present, the various commands all use Neo4j in embedded mode. This will not work if the server is running, because only one process can write to a graph DB at once. So before running anything, make sure the server is stopped:</p>
<p><b>NB</b>: Also note that the install script, in an effort to be helpful, starts the server at the end.</p>

<div class="source">
<div class="source">
<pre>$NEO4J_HOME/bin/neo4j stop
</pre></div></div></div>
<div class="section">
<h2><a name="Initialise_the_DB"></a>Initialise the DB</h2>
<p>Initialisation creates some nodes that are essential to the EHRI environment:</p>

<ul>
  
<li>The global event root node</li>
  
<li>The admin group</li>
  
<li>Permission type nodes</li>
  
<li>Content type nodes</li>
</ul>

<div class="source">
<div class="source">
<pre>./scripts/cmd initialize
</pre></div></div></div>
<div class="section">
<h2><a name="Create_a_user_account"></a>Create a user account</h2>
<p>So you can do stuff within the system, you need to make a yser profile for yourself. Probably you also want to add that profile to the admin group, which can be accomplished like so:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd useradd $USER --group admin
</pre></div></div></div>
<div class="section">
<h2><a name="Import_some_SKOS"></a>Import some SKOS</h2>
<p>To import some vocabulary terms you first need to create a vocabulary to which they will belong. We do this with the generic &#x201c;add&#x201d; command:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd add cvocVocabulary -Pidentifier=ehri-terms --user $USER --log &quot;Creating vocabulary for ehri terms.&quot;
</pre></div></div>
<p>The <tt>id</tt> handle of the created vocabulary will be derived from the &#x201c;identifier&#x201d; field. Since there is no enclosing scope, the resulting id will just be <tt>ehri-terms</tt>. We reference this for the scope parameter for the SKOS import command:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd skos-import --scope ehri-terms --user $USER --tolerant --user $USER  --log &quot;Importing EHRI SKOS&quot; PATH-TO-SKOS.rdf
</pre></div></div></div>
<div class="section">
<h2><a name="Import_some_EAD"></a>Import some EAD</h2>
<p><b>Note:</b> The process of importing EAD is currently a bit long-winded due to various database dependencies needing to be in place. In order to import documentary units you first need a &#x201c;scope&#x201d; (the repository) to add them to. Repositories likewise need their own scope, which is the country they reside in. (The reason for these dependencies is that the &#x201c;handle&#x201d; for any given document is &#x201c;scoped&#x201d; by its parents, i.e. the repository and the country item.)</p>
<p>As a consequence, importing is normally done via scripts that handle this housekeeping automatically, but for this example we&#x2019;ll do it manually:</p>
<div class="section">
<h3><a name="Creating_a_Country_Item"></a>Creating a &#x201c;Country&#x201d; Item</h3>
<p>To create a country item we can use the generic &#x201c;add&#x201d; command. The following creates a country identified by the ISO3166 two-letter country-code &#x201c;gb&#x201d; (the United Kingdom):</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd add country -Pidentifier=gb --user $USER --log &quot;Creating United Kingdom country item.&quot;
</pre></div></div></div>
<div class="section">
<h3><a name="Creating_the_Wiener_Library_Repository"></a>Creating the &#x201c;Wiener Library&#x201d; Repository</h3>
<p>Creating a repository would normally be done via importing an EAG (Encoded Archival Guide) file, but for now we will use the &#x201c;add&#x201d; command to create a bare-bones entry (with no descriptive data):</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd add repository -Pidentifier=wiener-library --user $USER --scope gb --log &quot;Creating repository.&quot;
</pre></div></div>
<p>(Note the &#x2013;scope takes the identifier we gave the country as an argument.)</p>
<p>The <i>scoped identifier</i> of the repository will be derived from the identifier we provided in a slugified form, plus the slugified identifiers of its parent scope. Therefore we can henceforth refer to this repository as &#x201c;gb-wiener-library&#x201d;.</p>
<p>To import an EAD file we use the <tt>ead-import</tt> command, refering to the repository scope, like so:</p>

<div class="source">
<div class="source">
<pre>export REPO=gb-wiener-library
./scripts/cmd ead-import -user $USER --scope $REPO --log &quot;Importing EAD for repository '$REPO'&quot; --tolerant PATH-TO-EAD-FILE.xml
</pre></div></div></div></div>
<div class="section">
<h2><a name="TODO"></a>TODO</h2>
<p>Importing EAC/EAG</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2015
                        <a href="http://ehri-project.eu">The European Holocaust Research Infrastructure (EHRI)</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
