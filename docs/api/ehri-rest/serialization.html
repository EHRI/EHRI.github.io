<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-10-14 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20141014" />
    <meta http-equiv="Content-Language" content="en" />
    <title>EHRI Backend &#x2013; REST Serialization</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                        <img src="https://ehri-project.eu/sites/all/themes/ehri_new/images/logo.png"  alt="EHRI Backend"/>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-10-14
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0
                          <span class="divider">|</span>
                      </li>
                                      <li class="">
                    <a href="index.html" title="EHRI Backend">
        EHRI Backend</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">REST Serialization</li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Developer Notes</li>
                              
      <li>
  
                          <a href="install.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                
      <li>
  
                          <a href="deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                
      <li>
  
                          <a href="import.html" title="Importing Data">
          <i class="none"></i>
        Importing Data</a>
            </li>
                
      <li>
  
                          <a href="gotchas.html" title="Gotchas">
          <i class="none"></i>
        Gotchas</a>
            </li>
                
      <li>
  
                          <a href="migrations.html" title="DB Migration History">
          <i class="none"></i>
        DB Migration History</a>
            </li>
                
      <li>
  
                          <a href="scripting.html" title="Scripting">
          <i class="none"></i>
        Scripting</a>
            </li>
                
      <li>
  
                          <a href="permissions.html" title="Permissions">
          <i class="none"></i>
        Permissions</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Data Serialization Config</a>
          </li>
                
      <li>
  
                          <a href="validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="identifiers.html" title="Identifiers">
          <i class="none"></i>
        Identifiers</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="ehri-definitions/index.html" title="Data Definitions">
          <i class="none"></i>
        Data Definitions</a>
            </li>
                
      <li>
  
                          <a href="ehri-frames/index.html" title="Core Java API">
          <i class="none"></i>
        Core Java API</a>
            </li>
                
      <li>
  
                          <a href="ehri-extension/index.html" title="Web Service">
          <i class="none"></i>
        Web Service</a>
            </li>
                
      <li>
  
                          <a href="ehri-importers/index.html" title="Import Tools">
          <i class="none"></i>
        Import Tools</a>
            </li>
                
      <li>
  
                          <a href="ehri-cmdline/index.html" title="Command Line Utilities">
          <i class="none"></i>
        Command Line Utilities</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                            
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
                              <li class="nav-header">API Docs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Javadocs">
          <i class="none"></i>
        Javadocs</a>
            </li>
                              <li class="nav-header">Web Service Docs</li>
                              
      <li>
  
                          <a href="ehri-extension/wsdocs/index.html" title="Web API">
          <i class="none"></i>
        Web API</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>REST Serialization</h1>
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
<p>Since individual REST resources (documentary units, repositories, etc) are comprised of many individual graph nodes, when resources are serialized we serialize their entire &#x201c;subtree&#x201d;, rather than force the client to fetch each object in parts on a node by node basis. We also allow certain relationships between resources (particularly key &#x201c;contextual&#x201d; relationships, to be included in the payload of a resource when fetching its data.</p>
<p>These features make for a much less &#x201c;chatty&#x201d; REST interface and one which works on the level of resources proper, rather than the raw nodes and relationships of which they are comprised at the database level. Performing such &#x201c;convenience&#x201d; traversals during serialization does, however, involve some tradeoffs and complexities.</p></div>
<div class="section">
<h2><a name="How_serialization_behavour_is_specified"></a>How serialization behavour is specified</h2>
<p>Serialization semantics are specified using Java annotations on adjacency methods present on the item domain model interfaces. Domain model interfaces are &#x201c;frames&#x201d; for raw graph vertices that provide convenience methods such as &#x201c;getRepository()&#x201d;. The behaviour for these interface methods (since they are obviously abstract) is provided by <a class="externalLink" href="https://github.com/tinkerpop/frames/wiki">Tinkerpop Frames</a> annotations such as <tt>@Adjacency(label = ..., direction = Direction.IN)</tt> which translate the method call to the desired graph behaviour, by, in this case, performing a graph traversal from a documentary unit node to that of its repository.</p>
<div class="section">
<h3><a name="EHRI-specific_annotations"></a>EHRI-specific annotations</h3>
<p>On top of the Tinkerpop Frames behaviour, the EHRI persistence layer adds two more annotations which control how framed domain models are serialized (to JSON, or XML, or whatever.) There are:</p>

<ul>
  
<li><tt>@Fetch</tt></li>
  
<li><tt>@Dependent</tt></li>
</ul>
<p><tt>@Fetch</tt> , when placed on an interface <tt>get</tt> method also decorated with <tt>@Adjacency</tt> means this relationship should be traversed and items at the other end included in the serialized data. <i>NB: Only mandatory properties for fetched items are included in the serialized data.</i></p>
<p><tt>@Dependent</tt>, when placed on an interface <tt>get</tt> method also decorated with <tt>@Adjacency</tt> means that that <i>this</i> item <i>belongs to</i> the target item. This is mainly used to sanity-check what data gets saved during <i>de-serialization</i>, but also affects the behaviour of <i>serialization</i> when deciding which data to include. Dependent items will be serialized with <i>all</i> data <i>unless</i> they belong to an item that is itself being included only in a <tt>@Fetch</tt> traversal.</p></div></div>
<div class="section">
<h2><a name="Serialization_parameters"></a>Serialization parameters</h2>
<p>There are a few parameters which affect the serializer&#x2019;s behaviour.</p>
<div class="section">
<h3><a name="Depth"></a>Depth</h3>
<p>There is a default limit for the number of relationships to traverse when fetching related items. This prevents circular relationships (should they exist) causing infinite recursion, and prevents us sucking too much of the graph.</p></div>
<div class="section">
<h3><a name="aLite_mode"></a>&#x2018;Lite&#x2019; mode</h3>
<p>This tells the serializer to <i>only</i> include mandatory properties for <i>all</i> items (normally this behaviour only applies to items that are <tt>@Fetch</tt>ed.</p></div>
<div class="section">
<h3><a name="Dependent_only"></a>Dependent only</h3>
<p>This tells the serializer to ignore all <tt>@Fetch</tt> traversals and only include those that are <tt>@Dependent</tt>.</p></div>
<div class="section">
<h3><a name="Overriding_Included_Properties"></a>Overriding Included Properties</h3>
<p>Sometimes you want to retrieve an item whilst insuring that a property of a relation is serialized. By default (and the default is currently fixed for the REST interface) only mandatory properties are included in automatically serialized relations. For example, when retrieving the data for a documentary unit, it&#x2019;s repository node is automatically included in the <tt>relationships</tt> data - however only the <b>mandatory</b> properties for the repository (it&#x2019;s <tt>identifier</tt> and it&#x2019;s description&#x2019;s <tt>name</tt> and <tt>languageCode</tt>s) are included in order to reduce unnecessary data transfer. We can, however, force tree serialization to include certain properties (which will apply indiscriminately to <b>all</b> data types thus serialized.) These can be specified in the <tt>includeProps</tt> parameter to the serializer, which takes a list of (string) property names to include in the output. From the REST interface, this can be done with the <tt>_ip=&lt;propname&gt;</tt> parameter (which can be given multiple times.)</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://ehri-project.eu">The European Holocaust Research Infrastructure (EHRI)</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
