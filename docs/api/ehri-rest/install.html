<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20151110" />
    <meta http-equiv="Content-Language" content="en" />
    <title>EHRI Backend &#x2013; Setup of development environment</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                        <img src="https://ehri-project.eu/sites/all/themes/ehri_new/images/logo.png"  alt="EHRI Backend"/>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-11-10
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 0.11.2-SNAPSHOT
                          <span class="divider">|</span>
                      </li>
                                      <li class="">
                    <a href="index.html" title="EHRI Backend">
        EHRI Backend</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Setup of development environment</li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Developer Notes</li>
                              
      <li class="active">
  
            <a href="#"><i class="none"></i>Installation</a>
          </li>
                
      <li>
  
                          <a href="deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                
      <li>
  
                          <a href="import.html" title="Importing Data">
          <i class="none"></i>
        Importing Data</a>
            </li>
                
      <li>
  
                          <a href="gotchas.html" title="Gotchas">
          <i class="none"></i>
        Gotchas</a>
            </li>
                
      <li>
  
                          <a href="migrations.html" title="DB Migration History">
          <i class="none"></i>
        DB Migration History</a>
            </li>
                
      <li>
  
                          <a href="scripting.html" title="Scripting">
          <i class="none"></i>
        Scripting</a>
            </li>
                
      <li>
  
                          <a href="permissions.html" title="Permissions">
          <i class="none"></i>
        Permissions</a>
            </li>
                
      <li>
  
                          <a href="serialization.html" title="Data Serialization Config">
          <i class="none"></i>
        Data Serialization Config</a>
            </li>
                
      <li>
  
                          <a href="validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="identifiers.html" title="Identifiers">
          <i class="none"></i>
        Identifiers</a>
            </li>
                
      <li>
  
                          <a href="web-service.html" title="Web Service Usage">
          <i class="none"></i>
        Web Service Usage</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="ehri-definitions/index.html" title="Data Definitions">
          <i class="none"></i>
        Data Definitions</a>
            </li>
                
      <li>
  
                          <a href="ehri-frames/index.html" title="Core Java API">
          <i class="none"></i>
        Core Java API</a>
            </li>
                
      <li>
  
                          <a href="ehri-extension/index.html" title="Web Service">
          <i class="none"></i>
        Web Service</a>
            </li>
                
      <li>
  
                          <a href="ehri-importers/index.html" title="Import Tools">
          <i class="none"></i>
        Import Tools</a>
            </li>
                
      <li>
  
                          <a href="ehri-cmdline/index.html" title="Command Line Utilities">
          <i class="none"></i>
        Command Line Utilities</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                            
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
                              <li class="nav-header">API Docs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Javadocs">
          <i class="none"></i>
        Javadocs</a>
            </li>
                              <li class="nav-header">Web Service Docs</li>
                              
      <li>
  
                          <a href="ehri-extension/wsdocs/index.html" title="Web API">
          <i class="none"></i>
        Web API</a>
            </li>
                                    
      <li>
  
                          <a href="samples.tgz" title="Import Data Samples">
          <i class="none"></i>
        Import Data Samples</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Setup of development environment</h1>
<div class="section">
<h2><a name="Prerequisites"></a>Prerequisites</h2>
<p>Install Oracle JDK 7. For Ubuntu this can be done via the Webupd8team PPA:</p>

<div class="source">
<div class="source">
<pre>sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java7-installer 
</pre></div></div>
<p>Install Git:</p>

<div class="source">
<div class="source">
<pre>sudo apt-get install git
</pre></div></div>
<p>Install Curl:</p>

<div class="source">
<div class="source">
<pre>sudo apt-get install curl
</pre></div></div>
<p>Make somewhere to put downloaded Java apps:</p>

<div class="source">
<div class="source">
<pre>mkdir ~/apps
</pre></div></div>
<p>Download and install Maven:</p>

<div class="source">
<div class="source">
<pre>export MVN_VERSION=3.0.5
curl -0 http://apache.mirrors.timporter.net/maven/maven-3/${MVN_VERSION}/binaries/apache-maven-${MVN_VERSION}-bin.tar.gz | tar -zx -C ~/apps
</pre></div></div>
<p>Add Maven to $PATH:</p>

<div class="source">
<div class="source">
<pre>export PATH=$PATH:$HOME/apps/apache-maven-${MVN_VERSION}/bin
</pre></div></div>
<p>(It&#x2019;s best to add these lines to your .bashrc or .bash_profile file too)</p></div>
<div class="section">
<h2><a name="Checking_out_the_EHRI_REST-server_code"></a>Checking out the EHRI REST-server code</h2>
<p>Make somewhere to put your code:</p>

<div class="source">
<div class="source">
<pre>mkdir ~/dev
cd ~/dev
</pre></div></div>
<p>Clone the EHRI server code from Github:</p>

<div class="source">
<div class="source">
<pre>git clone https://github.com/EHRI/ehri-rest.git
cd ehri-rest
mvn install
</pre></div></div>
<p>(Maven will then proceed to download hundreds of megabytes of dependencies, but most of this will only have to be downloaded once.)</p>
<p>While Maven is doing its thing, we can install a standalone version of the Neo4j server. Once the code has been built, we can enable the EHRI REST service within the standalone Neo4j server.</p>

<div class="source">
<div class="source">
<pre>curl -L -0 http://neo4j.com/artifact.php?name=neo4j-community-2.3.0-unix.tar.gz | tar zx
</pre></div></div>
<p>We&#x2019;ll need to refer to the installation location a lot so save it as an environment variable:</p>

<div class="source">
<div class="source">
<pre>export NEO4J_HOME=neo4j-community-2.3.0
</pre></div></div>
<p>Once both the EHRI server code has been compiled and Neo4j standalone has been downloaded and extracted, we can install the former into the latter. The following script ensures the code is packaged and then installs the EHRI jars and various other dependencies into the <tt>$NEO4J_HOME/plugin/ehri</tt> directory:</p>

<div class="source">
<div class="source">
<pre>./scripts/install.sh
</pre></div></div>
<p>Once that has completed the script will warn us that we have to make one configuation change manually:</p>

<blockquote>
<p><b>IMPORTANT</b>: You must manually ensure the $NEO4J_HOME/conf/neo4j-server.properties configuration contains the line:  org.neo4j.server.thirdparty_jaxrs_classes=eu.ehri.extension=/ehri</p>
</blockquote>
<p>Open that file and add that line below the point where a similar example config is commented out. This step is vital so Neo4j knows to load our EHRI extension code.</p>
<p>At this point, if we go to <a class="externalLink" href="http://localhost:7474">http://localhost:7474</a> we should be able to see the Neo4j server admin console. However, the EHRI Rest server endpoints will error at the moment because we have not yet initialised the graph database properly. We can do this using one of the EHRI administration commands that can be run from the code root. First, make sure the Neo4j database server isn&#x2019;t running:</p>

<div class="source">
<div class="source">
<pre>$NEO4J_HOME/bin/neo4j stop
</pre></div></div>
<p>Then run the following commands from the EHRI code root:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd initialize  # NB: This can only be done once!
</pre></div></div>
<p>We also need to create an administrative user account:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd useradd $USER --group admin
</pre></div></div>
<p>Now we can start the server again and check everything is working:</p>

<div class="source">
<div class="source">
<pre>$NEO4J_HOME/bin/neo4j start

curl -H &quot;X-User:$USER&quot; localhost:7474/ehri/userProfile/$USER
</pre></div></div>
<p>We should get the following output (with &#x201c;mike&#x201d; replaced by your $USER):</p>

<div class="source">
<div class="source">
<pre>{
  &quot;id&quot; : &quot;mike&quot;,
  &quot;data&quot; : {
    &quot;name&quot; : &quot;mike&quot;,
    &quot;identifier&quot; : &quot;mike&quot;
  },
  &quot;type&quot; : &quot;userProfile&quot;,
  &quot;relationships&quot; : {
    &quot;lifecycleEvent&quot; : [ {
      &quot;id&quot; : &quot;211a5a7e-6430-4b51-b1fb-e8ba562a4118&quot;,
      &quot;data&quot; : {
    &quot;timestamp&quot; : &quot;2013-04-25T16:24:41.777+01:00&quot;,
    &quot;logMessage&quot; : &quot;Created via command-line&quot;
      },
      &quot;type&quot; : &quot;systemEvent&quot;,
      &quot;relationships&quot; : {
    &quot;hasActioner&quot; : [ {
      &quot;id&quot; : &quot;admin&quot;,
      &quot;data&quot; : {
        &quot;name&quot; : &quot;Administrators&quot;,
        &quot;identifier&quot; : &quot;admin&quot;
      },
      &quot;type&quot; : &quot;group&quot;,
      &quot;relationships&quot; : {
      }
    } ]
      }
    } ],
    &quot;belongsTo&quot; : [ {
      &quot;id&quot; : &quot;admin&quot;,
      &quot;data&quot; : {
    &quot;name&quot; : &quot;Administrators&quot;,
    &quot;identifier&quot; : &quot;admin&quot;
      },
      &quot;type&quot; : &quot;group&quot;,
      &quot;relationships&quot; : {
      }
    } ]
  }
}
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2015
                        <a href="http://ehri-project.eu">The European Holocaust Research Infrastructure (EHRI)</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
