<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-12-10 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20141210" />
    <meta http-equiv="Content-Language" content="en" />
    <title>EHRI Backend &#x2013; Miscellaneous Gotchas</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                        <img src="https://ehri-project.eu/sites/all/themes/ehri_new/images/logo.png"  alt="EHRI Backend"/>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-12-10
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0
                          <span class="divider">|</span>
                      </li>
                                      <li class="">
                    <a href="index.html" title="EHRI Backend">
        EHRI Backend</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Miscellaneous Gotchas</li>
                
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Developer Notes</li>
                              
      <li>
  
                          <a href="install.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                
      <li>
  
                          <a href="deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                
      <li>
  
                          <a href="import.html" title="Importing Data">
          <i class="none"></i>
        Importing Data</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Gotchas</a>
          </li>
                
      <li>
  
                          <a href="migrations.html" title="DB Migration History">
          <i class="none"></i>
        DB Migration History</a>
            </li>
                
      <li>
  
                          <a href="scripting.html" title="Scripting">
          <i class="none"></i>
        Scripting</a>
            </li>
                
      <li>
  
                          <a href="permissions.html" title="Permissions">
          <i class="none"></i>
        Permissions</a>
            </li>
                
      <li>
  
                          <a href="serialization.html" title="Data Serialization Config">
          <i class="none"></i>
        Data Serialization Config</a>
            </li>
                
      <li>
  
                          <a href="validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="identifiers.html" title="Identifiers">
          <i class="none"></i>
        Identifiers</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="ehri-definitions/index.html" title="Data Definitions">
          <i class="none"></i>
        Data Definitions</a>
            </li>
                
      <li>
  
                          <a href="ehri-frames/index.html" title="Core Java API">
          <i class="none"></i>
        Core Java API</a>
            </li>
                
      <li>
  
                          <a href="ehri-extension/index.html" title="Web Service">
          <i class="none"></i>
        Web Service</a>
            </li>
                
      <li>
  
                          <a href="ehri-importers/index.html" title="Import Tools">
          <i class="none"></i>
        Import Tools</a>
            </li>
                
      <li>
  
                          <a href="ehri-cmdline/index.html" title="Command Line Utilities">
          <i class="none"></i>
        Command Line Utilities</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                            
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
                              <li class="nav-header">API Docs</li>
                              
      <li>
  
                          <a href="apidocs/index.html" title="Javadocs">
          <i class="none"></i>
        Javadocs</a>
            </li>
                              <li class="nav-header">Web Service Docs</li>
                              
      <li>
  
                          <a href="ehri-extension/wsdocs/index.html" title="Web API">
          <i class="none"></i>
        Web API</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Miscellaneous Gotchas</h1>
<div class="section">
<h2><a name="Online_Backup_Fails_with_BlockingReadTimeoutException"></a>Online Backup Fails with BlockingReadTimeoutException</h2>

<div class="source">
<div class="source">
<pre>Couldn't connect to 'single://localhost:6362'
org.neo4j.com.ComException: org.jboss.netty.handler.queue.BlockingReadTimeoutException
</pre></div></div>
<p>This has been observed to occur when the database has had some offline operations applied to it, i.e. an bulk data import. The server appears to otherwise function without problems. The error seemingly went away when the database was written to in some (trivial) way, i.e. watching/unwatching an item.</p></div>
<div class="section">
<h2><a name="Mysterious_ItemNotFound_exceptions_in_unexpected_places_i.e._importing_data"></a>Mysterious ItemNotFound exceptions in unexpected places, i.e. importing data</h2>
<p>It has been known on some very rare occasions for unexpected ItemNotFound exceptions to be thrown in places where that doesn&#x2019;t seem to make sense, i.e. the API can&#x2019;t find data it&#x2019;s just created. The cause of this seems to be the Neo4j index somehow getting corrupted, which means that item index lookups fail. The way to fix this is to rebuild the graph index via the <tt>reindex</tt> command. First, make sure the Neo4j server is stopped:</p>

<div class="source">
<div class="source">
<pre>./neo4j-community-1.9.2/bin/neo4j stop
</pre></div></div>
<p>Then, ensuring that the <tt>$NEO4J_HOME</tt> var is correctly set to point to your database, run:</p>

<div class="source">
<div class="source">
<pre>./scripts/cmd reindex
</pre></div></div>
<p>This should only take a couple of seconds. It will first delete the global graph index (name &#x201c;entities&#x201d;), create it again, and then iterate over every node adding its mandatory properties.</p>
<p>The precise cause of this index corruption is not known, and it&#x2019;s only been witnessed on very specific Apple Macs (i.e. one dev&#x2019;s machine.)</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="http://ehri-project.eu">The European Holocaust Research Infrastructure (EHRI)</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
